<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Among Us Guessing Game</title>
    <link rel="stylesheet" href="bootstrap.min.css">
    <style>
        .score {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .round-info {
            font-size: 1.25em;
            margin-top: 10px;
        }

        .disabled-card {
            background-color: #f8f9fa !important;
            opacity: 0.6;
            pointer-events: none;
        }

        .impostor-text {
            color: red;
            font-weight: bold;
        }

        #nextRoundButton {
            display: none; /* Hidden initially */
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container-lg mt-4">
        <h1 class="text-center mb-3">SUPERSUS - GUESSING GAME</h1>

        <!-- Score Display -->
        <div class="d-flex justify-content-between">
          <div class="score" id="scoreDisplay">
              Score: 0
          </div>
          <div class="round-info" id="roundInfo">
              Round: 1 | Guesses Left: 3
          </div>
      </div>
      
      
        <div class="card">
            <div class="card-header">
                <h2 class="card-title text-center">Who is the impostor?</h2>
            </div>
            <div class="card-body">
                <div class="row g-3">
                  <div class="col-lg-9 col-sm-9">
                    <div class="row g-3" id="players">

                    </div>
                  </div>
                  <div class="col-lg-3 col-sm-3">
                    <div class="row g-3">
                        <div class="col-lg-12 col-sm-12">
                            <div class="card">
                                <div class="card-header">
                                    <p class="card-title">Meeting Assistant</p>
                                </div>
                                <div class="card-body">
                                    <div class="m-0">Roles in this match:</div>
                                    <div class="mt-0">
                                        Spacecrews 8, Impostors 2
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12">
                          <div class="card">
                            <div class="card-body">
                              <div id="correctIncorrectDisplay" class="result-message">
                                Correct Guesses: 0 | Wrong Guesses: 0
                              </div>
                            </div>
                          </div>
                        </div>
                    </div>
                </div>
                </div>
                
            </div>
            
        </div>

        <!-- Next Round Button -->
        <button id="nextRoundButton" class="btn btn-primary" onclick="nextRound()">Go to Next Round</button>
    </div>

    <script>
        // Function to read a cookie by name
        function getCookie(name) {
            let cookieArr = document.cookie.split(';');
            for (let i = 0; i < cookieArr.length; i++) {
                let cookie = cookieArr[i].trim();
                if (cookie.indexOf(name + "=") == 0) {
                    return cookie.substring(name.length + 1, cookie.length);
                }
            }
            return "";
        }

        // Function to set a cookie
        function setCookie(name, value, days) {
            let date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            let expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }

        // Function to load game state from cookies
        function loadGameState() {
            score = parseInt(getCookie('score')) || 0;
            round = parseInt(getCookie('round')) || 1;
            guessesLeft = parseInt(getCookie('guessesLeft')) || 3;
            correctGuesses = parseInt(getCookie('correctGuesses')) || 0;
            wrongGuesses = parseInt(getCookie('wrongGuesses')) || 0;
        }

        // Function to save game state to cookies
        function saveGameState() {
            setCookie('score', score, 7);
            setCookie('round', round, 7);
            setCookie('guessesLeft', guessesLeft, 7);
            setCookie('correctGuesses', correctGuesses, 7);
            setCookie('wrongGuesses', wrongGuesses, 7);
        }

        // Loading the game state when the page is loaded
        window.onload = function() {
            loadGameState();  // Load saved data from cookies
            generateRoles();  // Generate roles for the current round
            createPlayerCards();  // Create the player cards for the current round
            updateScoreDisplay();  // Update the score display
            updateRoundInfo();  // Update the round and guesses left display
            updateCorrectIncorrectDisplay(); // Display correct/incorrect guesses
        }

        // Players and impostors
        const players = ["BLUE", "RED", "GREEN", "YELLOW", "ORANGE", "PURPLE", "PINK", "BROWN", "WHITE", "CYAN"];
        const impostorsCount = 2;
        let impostors = [];
        let playerRoles = [];
        let score = 0; // Track the player's score
        let round = 1; // Track the current round
        let guessesLeft = 3; // Track guesses left for current round
        let correctGuesses = 0; // Track correct guesses
        let wrongGuesses = 0; // Track wrong guesses

        // Function to generate roles for players
        function generateRoles() {
            const allPlayers = [...players];
            allPlayers.sort(() => Math.random() - 0.5);
            
            impostors = allPlayers.slice(0, impostorsCount);
            playerRoles = allPlayers.map(player => impostors.includes(player) ? 'Impostor' : 'Crewmate');
        }

        // Function to create player cards
        function createPlayerCards() {
            const playerContainer = document.getElementById("players");
            playerContainer.innerHTML = ""; // Clear existing players

            players.forEach((player, index) => {
                const playerCard = document.createElement("div");
                playerCard.classList.add("col-lg-6", "col-sm-6");
                playerCard.setAttribute("id", `player-${player}`);
                playerCard.innerHTML = `
                    <div class="card" style="border-left: 5px solid ${getColorForPlayer(player)};">
                        <div class="card-body d-flex justify-content-between align-items-center" id="card-${player}">
                            <p class="mb-0">${player}</p>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-crosshair" viewBox="0 0 16 16" role="button" style="cursor: pointer;" onclick="handleGuess('${player}')">
                                <path d="M8.5.5a.5.5 0 0 0-1 0v.518A7 7 0 0 0 1.018 7.5H.5a.5.5 0 0 0 0 1h.518A7 7 0 0 0 7.5 14.982v.518a.5.5 0 0 0 1 0v-.518A7 7 0 0 0 14.982 8.5h.518a.5.5 0 0 0 0-1h-.518A7 7 0 0 0 8.5 1.018zm-6.48 7A6 6 0 0 1 7.5 2.02v.48a.5.5 0 0 0 1 0v-.48a6 6 0 0 1 5.48 5.48h-.48a.5.5 0 0 0 0 1h.48a6 6 0 0 1-5.48 5.48v-.48a.5.5 0 0 0-1 0v.48A6 6 0 0 1 2.02 8.5h.48a.5.5 0 0 0 0-1zM8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4"/>
                            </svg>
                        </div>
                    </div>
                `;
                playerContainer.appendChild(playerCard);
            });
        }

        // Function to get color for player
        function getColorForPlayer(player) {
            const colorMapping = {
                "BLUE": "blue",
                "RED": "red",
                "GREEN": "green",
                "YELLOW": "yellow",
                "ORANGE": "orange",
                "PURPLE": "purple",
                "PINK": "pink",
                "BROWN": "brown",
                "WHITE": "white",
                "CYAN": "cyan"
            };
            return colorMapping[player] || 'gray';
        }

        // Handle the guess when the icon is clicked
        function handleGuess(player) {
            const isImpostor = impostors.includes(player);
            
            if (isImpostor) {
                score += 10; // Add points for a correct guess
                correctGuesses++; // Increment correct guesses
                showImpostorStatus(player, true); // Show impostor text
            } else {
                wrongGuesses++; // Increment wrong guesses
                showImpostorStatus(player, false); // Show impostor text
            }
            updateScoreDisplay();
            guessesLeft--; // Decrease guess count
            updateRoundInfo();
            updateCorrectIncorrectDisplay();
            disableCard(player); // Disable the card after guessing
            checkEndOfRound();
            saveGameState(); // Save game state to cookies
        }

        // Show Impostor Text on the Card
        function showImpostorStatus(player, isImpostor) {
            const cardBody = document.getElementById(`card-${player}`);
            const impostorText = document.createElement('p');
            impostorText.classList.add('impostor-text', 'mb-0');
            impostorText.innerText = isImpostor ? "Impostor" : "Spacecrew";
            impostorText.style.color = isImpostor ? 'red' : 'blue';
            impostorText.style.fontSize = impostorText.innerText.length > 30 ? "0.9em" : "1.1em";
            cardBody.appendChild(impostorText);
        }

        // Disable the player card and hide the icon
        function disableCard(player) {
            const playerCard = document.getElementById(`player-${player}`);
            const icon = playerCard.querySelector('svg'); 
            playerCard.classList.add("disabled-card"); 
            if (icon) {
                icon.style.display = "none"; 
            }
        }

        // Check if the round is over
        function checkEndOfRound() {
            if (guessesLeft <= 0) {
                disableAllIcons();
                document.getElementById("nextRoundButton").style.display = "block";
            }
        }

        // Disable all icons when guesses are finished
        function disableAllIcons() {
            const icons = document.querySelectorAll('svg');
            icons.forEach(icon => {
                icon.style.pointerEvents = "none";
            });
        }

        // Next round function
        function nextRound() {
            round++;
            guessesLeft = 3;
            generateRoles();
            createPlayerCards();
            updateRoundInfo();
            document.getElementById("nextRoundButton").style.display = "none";
            saveGameState();
        }

        // Update round and guesses
        function updateRoundInfo() {
            document.getElementById("roundInfo").innerText = `Round: ${round} | Guesses Left: ${guessesLeft}`;
        }

        // Update score display
        function updateScoreDisplay() {
            document.getElementById("scoreDisplay").innerText = `Score: ${score}`;
        }

        // Update correct/incorrect guesses
        function updateCorrectIncorrectDisplay() {
            document.getElementById("correctIncorrectDisplay").innerText = `Correct Guesses: ${correctGuesses} | Wrong Guesses: ${wrongGuesses}`;
        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
